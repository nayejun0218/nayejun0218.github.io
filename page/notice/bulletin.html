<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì£¼ë³´ ì•ˆë‚´ - The Bridge Community Church</title>
  <link rel="stylesheet" href="/style/style.css">
  <link rel="stylesheet" href="/style/page.css">
  <link rel="stylesheet" href="/style/sermon.css">
</head>
<body>
  <div id="header"></div>
  <main>
    <section class="bulletin">
      <h2>ì£¼ë³´ ì•ˆë‚´</h2>
      <div class="bulletin-content">
        <div class="sermon-section-title-wrap" style="display: flex; align-items: center; justify-content: space-between;">
          <div class="sermon-section-title">2025ë…„ ì£¼ë³´</div>
          <button id="toggle-bulletin-list" style="background:none;border:none;cursor:pointer;font-size:2rem;line-height:1;outline:none;padding:0 0.5rem;" aria-label="ë”ë³´ê¸°"><span id="arrow-icon">â–¼</span></button>
        </div>
        <hr class="section-divider">
        <div id="bulletin-list" class="bulletin-grid">
          <p>ì£¼ë³´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
        <p style="margin-top: 2rem; color: #666; font-size: 0.9rem;">
          ğŸ’¡ ì£¼ê°„/ì›”ê°„ êµíšŒ ì£¼ë³´ë¥¼ PDFë¡œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br>
          ğŸ’¡ ì£¼ë³´ê°€ ë³´ì´ì§€ ì•Šìœ¼ì‹œë©´ ë¸Œë¼ìš°ì €ì—ì„œ PDF ë·°ì–´ë¥¼ í™œì„±í™”í•´ì£¼ì„¸ìš”.
        </p>
      </div>
    </section>
  </main>
  <div id="footer"></div>
  <script src="/main.js"></script>
  <script>
    fetch('/header.html')
      .then(res => res.text())
      .then(data => { document.getElementById('header').innerHTML = data; });
    fetch('/footer.html')
      .then(res => res.text())
      .then(data => { document.getElementById('footer').innerHTML = data; });

    // ì£¼ë³´ ë°ì´í„° ë¡œë“œ (GitHub Actionsë¡œ ìë™ ì—…ë°ì´íŠ¸ëœ JSON ì‚¬ìš©)
    async function loadBulletinData() {
      try {
        const res = await fetch('/bulletins.json');
        if (!res.ok) {
          throw new Error(`ì£¼ë³´ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${res.status}`);
        }
        return await res.json();
      } catch (error) {
        console.error('ì£¼ë³´ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error.message);
        return [];
      }
    }

    loadBulletinData().then(bulletins => {
      const grid = document.getElementById('bulletin-list');
      
      if (bulletins.length === 0) {
        grid.innerHTML = '<p>ë“±ë¡ëœ ì£¼ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }

      // ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬ (ìµœì‹ ìˆœ, ë‚´ë¦¼ì°¨ìˆœ)
      bulletins.sort((a, b) => {
        // date í•„ë“œ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ (ë” ì •í™•í•¨)
        try {
          // date í•„ë“œê°€ "2025.09.21" í˜•ì‹ì´ë¯€ë¡œ Date ê°ì²´ë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ
          const dateA = new Date(a.date.replace(/\./g, '-'));
          const dateB = new Date(b.date.replace(/\./g, '-'));
          
          // ë‚ ì§œê°€ ìœ íš¨í•œì§€ í™•ì¸
          if (isNaN(dateA.getTime()) || isNaN(dateB.getTime())) {
            // ë‚ ì§œê°€ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ createdTimeìœ¼ë¡œ í´ë°±
            return new Date(b.createdTime) - new Date(a.createdTime);
          }
          
          // ë‚ ì§œê°€ ê°™ìœ¼ë©´ createdTimeìœ¼ë¡œ ì„¸ë¶€ ì •ë ¬
          if (dateA.getTime() === dateB.getTime() && a.createdTime && b.createdTime) {
            return new Date(b.createdTime) - new Date(a.createdTime);
          }
          
          return dateB - dateA; // ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹  â†’ ê³¼ê±°)
        } catch (error) {
          console.warn('ë‚ ì§œ ì •ë ¬ ì¤‘ ì˜¤ë¥˜:', error);
          // ì˜¤ë¥˜ ë°œìƒ ì‹œ createdTimeìœ¼ë¡œ í´ë°±
          return new Date(b.createdTime) - new Date(a.createdTime);
        }
      });

      console.log('ì •ë ¬ëœ ì£¼ë³´ ìˆœì„œ:');
      bulletins.slice(0, 5).forEach((bulletin, index) => {
        console.log(`${index + 1}. ${bulletin.date} - ${bulletin.name}`);
      });

      grid.innerHTML = bulletins.map(bulletin => `
        <div class="bulletin-card">
          <div class="bulletin-date">${bulletin.date}</div>
          <h3 class="bulletin-title">${bulletin.name}</h3>
          <div class="bulletin-actions">
            <a href="${bulletin.viewLink}" target="_blank" class="bulletin-btn view-btn">
              ğŸ“– ë³´ê¸°
            </a>
            <a href="${bulletin.downloadLink}" target="_blank" class="bulletin-btn download-btn">
              ğŸ“¥ ë‹¤ìš´ë¡œë“œ
            </a>
          </div>
        </div>
      `).join('');

      // ë”ë³´ê¸°/ìŠ¬ë¼ì´ë“œ ë‹¤ìš´ ê¸°ëŠ¥ (ì„¤êµ í˜ì´ì§€ì™€ ë™ì¼í•œ ë¡œì§)
      const cards = grid.querySelectorAll('.bulletin-card');
      const btn = document.getElementById('toggle-bulletin-list');
      let expanded = false;

      function getCardHeight(n) {
        if (cards.length === 0) return 0;
        const card = cards[0];
        const style = window.getComputedStyle(grid);
        const gap = parseFloat(style.gap) || 0;
        // í•œ ì¤„ì— ëª‡ ê°œê°€ ë“¤ì–´ê°€ëŠ”ì§€ ë™ì ìœ¼ë¡œ ê³„ì‚°
        const cardsPerRow = Math.floor(grid.offsetWidth / card.offsetWidth) || 1;
        const rowCount = Math.ceil(n / cardsPerRow);
        const cardHeight = card.offsetHeight;
        if (cardHeight === 0) {
          return (250 + gap) * rowCount; 
        }
        return rowCount * cardHeight + (rowCount - 1) * gap + 20;
      }

      function updateView() {
        if (expanded) {
          grid.style.maxHeight = getCardHeight(cards.length) + 'px';
        } else {
          grid.style.maxHeight = getCardHeight(4) + 'px'; // ì²˜ìŒì—ëŠ” 6ê°œë§Œ ë³´ì´ê²Œ
        }
        btn.setAttribute('aria-label', expanded ? 'ì ‘ê¸°' : 'ë”ë³´ê¸°');
        btn.classList.toggle('open', expanded);
      }

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ì¤‘ë³µìœ¼ë¡œ ë“±ë¡ë˜ì§€ ì•Šë„ë¡ í•œ ë²ˆë§Œ ì‹¤í–‰
      if (!btn.dataset.listenerAttached) {
          btn.addEventListener('click', function() {
            expanded = !expanded;
            updateView();
          });
          window.addEventListener('resize', () => updateView());
          btn.dataset.listenerAttached = 'true';
      }
      
      // ìµœì´ˆ 6ê°œë§Œ ë³´ì´ê²Œ ì„¤ì •
      updateView();
    }).catch(error => {
      console.error('ì£¼ë³´ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
      document.getElementById('bulletin-list').innerHTML = 
        '<p>ì£¼ë³´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>';
    });
  </script>

  <style>
    .bulletin-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1.2rem;
      margin-top: 1.5rem;
      overflow: hidden;
      transition: max-height 0.4s ease-in-out;
      max-height: 600px; /* ì´ˆê¸° ë†’ì´ ì„¤ì • */
    }

    .bulletin-card {
      background: #f0f4ff;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
    }

    .bulletin-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }

    .bulletin-date {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }

    .bulletin-title {
      color: #2c3e50;
      font-size: 1.1rem;
      margin-bottom: 1rem;
      font-weight: 600;
    }

    .bulletin-actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .bulletin-btn {
      display: inline-block;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 500;
      transition: background 0.2s;
    }

    .view-btn {
      background: #5a6fd8;
      color: white;
    }

    .view-btn:hover {
      background: #222567;
    }

    .download-btn {
      background: #95a5a6;
      color: white;
    }

    .download-btn:hover {
      background: #222567;
      color: white;
    }

    /* ì„¤êµ í˜ì´ì§€ì™€ ë™ì¼í•œ ë”ë³´ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #toggle-bulletin-list {
      color: #666;
      transition: transform 0.3s ease;
    }

    #toggle-bulletin-list:hover {
      color: #333;
    }

    #toggle-bulletin-list.open #arrow-icon {
      transform: rotate(180deg);
    }

    #arrow-icon {
      transition: transform 0.3s ease;
    }

    @media (max-width: 1200px) {
      .bulletin-grid {
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      }
    }

    @media (max-width: 768px) {
      .bulletin-grid {
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1rem;
      }
      
      .bulletin-actions {
        flex-direction: column;
      }
      
      .bulletin-btn {
        text-align: center;
      }
    }

    @media (max-width: 480px) {
      .bulletin-grid {
        grid-template-columns: 1fr;
      }
    }
    
    /* sermon.cssì™€ ë™ì¼í•œ ëª¨ë°”ì¼ ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ ì¶”ê°€ */
    @media (max-width: 1024px) {
      .sermon-section-title {
        font-size: 1.6rem;
        margin: 1.8rem 0 1rem 0;
      }
      
      .bulletin-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1.8rem;
      }
      
      .bulletin-card {
        padding: 1.2rem;
      }
      
      .bulletin-title {
        font-size: 1rem;
      }
      
      .bulletin-btn {
        font-size: 0.95rem;
        padding: 0.5em 1.2em;
      }
      
      #toggle-bulletin-list {
        font-size: 1.5rem;
      }
      
      .bulletin-content p {
        font-size: 0.8rem;
      }
    }
    
    @media (max-width: 600px) {
      .bulletin-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
      }
      
      .bulletin-card {
        padding: 1rem;
        min-height: auto !important;
        min-width: auto !important;
      }
      
      .bulletin-title {
        font-size: 0.9rem;
        margin-bottom: 0.8rem;
      }
      
      .bulletin-date {
        font-size: 0.8rem;
      }
      
      .bulletin-btn {
        font-size: 0.85rem;
        padding: 0.4em 0.8em;
      }
      
      #toggle-bulletin-list {
        font-size: 1.8rem;
      }
      
      .bulletin-content p {
        font-size: 0.8rem;
      }
    }

    @media (max-width: 370px) {
      .sermon-section-title {
        font-size: 1.1rem;
        margin: 0.8rem 0 0.5rem 0;
      }
      
      .bulletin-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1.3rem;
      }
      
      .bulletin-card {
        padding: 0.5rem;
        min-height: auto !important;
        min-width: auto !important;
      }
      
      .bulletin-title {
        font-size: 0.8rem;
        margin-bottom: 0.5rem;
      }
      
      .bulletin-date {
        font-size: 0.7rem;
      }
      
      .bulletin-btn {
        font-size: 0.75rem;
        padding: 0.3em 0.6em;
      }
      
      #toggle-bulletin-list {
        font-size: 1.6rem !important;
      }
      
      .bulletin-content p {
        font-size: 0.7rem !important;
      }
    }
  </style>
</body>
</html> 